<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Optimization-Based ODE Parameter Estimation · DiffEqParamEstim.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/DiffEqParamEstim/stable/tutorials/ODE_inference/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="DiffEqParamEstim.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DiffEqParamEstim.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">DiffEqParamEstim.jl: Parameter Estimation for Differential Equations</a></li><li><span class="tocitem">Tutorials</span><ul><li class="is-active"><a class="tocitem" href>Optimization-Based ODE Parameter Estimation</a></li><li><a class="tocitem" href="../global_optimization/">Global Optimization via NLopt</a></li><li><a class="tocitem" href="../jump/">Using JuMP with DiffEqParamEstim</a></li><li><a class="tocitem" href="../generalized_likelihood/">Generalized Likelihood Inference</a></li><li><a class="tocitem" href="../stochastic_evaluations/">Parameter Estimation for Stochastic Differential Equations and Ensembles</a></li><li><a class="tocitem" href="../ensemble/">Fitting Ensembles of ODE Models to Data</a></li></ul></li><li><span class="tocitem">Methods</span><ul><li><a class="tocitem" href="../../methods/recommended_methods/">Recommended Methods</a></li><li><a class="tocitem" href="../../methods/optimization_based_methods/">Optimization-Based Methods</a></li><li><a class="tocitem" href="../../methods/collocation_loss/">Two Stage method (Non-Parametric Collocation)</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Optimization-Based ODE Parameter Estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Optimization-Based ODE Parameter Estimation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/DiffEqParamEstim.jl/blob/master/docs/src/tutorials/ODE_inference.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Optimization-Based-ODE-Parameter-Estimation"><a class="docs-heading-anchor" href="#Optimization-Based-ODE-Parameter-Estimation">Optimization-Based ODE Parameter Estimation</a><a id="Optimization-Based-ODE-Parameter-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Optimization-Based-ODE-Parameter-Estimation" title="Permalink"></a></h1><p>We choose to optimize the parameters on the Lotka-Volterra equation. We do so by defining the function as a function with parameters:</p><pre><code class="language-julia hljs">using DifferentialEquations, RecursiveArrayTools, Plots, Optim, DiffEqParamEstim, BlackBoxOptim
using Optimization, Zygote, OptimizationOptimJL, OptimizationBBO, SciMLSensitivity

function f(du,u,p,t)
  du[1] = dx = p[1]*u[1] - u[1]*u[2]
  du[2] = dy = -3*u[2] + u[1]*u[2]
end

u0 = [1.0;1.0]
tspan = (0.0,10.0)
p = [1.5]
prob = ODEProblem(f,u0,tspan,p)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ODEProblem with uType Vector{Float64} and tType Float64. In-place: true
timespan: (0.0, 10.0)
u0: 2-element Vector{Float64}:
 1.0
 1.0</code></pre><p>We create data using the numerical result with <code>a=1.5</code>:</p><pre><code class="language-julia hljs">sol = solve(prob,Tsit5())
t = collect(range(0,stop=10,length=200))
using RecursiveArrayTools # for VectorOfArray
randomized = VectorOfArray([(sol(t[i]) + .01randn(2)) for i in 1:length(t)])
data = convert(Array,randomized)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2×200 Matrix{Float64}:
 1.00981  1.02322   1.07131   1.104     …  0.986367  1.01074  1.02961
 1.00536  0.901873  0.826303  0.740078     1.10904   1.01568  0.904663</code></pre><p>Here we used <code>VectorOfArray</code> from <a href="https://docs.sciml.ai/RecursiveArrayTools/stable/">RecursiveArrayTools.jl</a> to turn the result of an ODE into a matrix.</p><p>If we plot the solution with the parameter at <code>a=1.42</code>, we get the following:</p><p><img src="../../assets/paramest_notfit.png" alt="Parameter Estimation Not Fit"/></p><p>Notice that after one period this solution begins to drift very far off: this problem is sensitive to the choice of <code>a</code>.</p><p>To build the objective function for Optim.jl, we simply call the <code>build_loss_objective</code> function:</p><pre><code class="language-julia hljs">cost_function = build_loss_objective(prob,Tsit5(),L2Loss(t,data),
                                     maxiters=10000,verbose=false)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(::SciMLBase.OptimizationFunction{true, SciMLBase.NoAD, DiffEqParamEstim.var&quot;#29#30&quot;{Nothing, typeof(DiffEqParamEstim.STANDARD_PROB_GENERATOR), Base.Pairs{Symbol, Integer, Tuple{Symbol, Symbol}, NamedTuple{(:maxiters, :verbose), Tuple{Int64, Bool}}}, SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, Vector{Float64}, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.f), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, NamedTuple{(), Tuple{}}}, SciMLBase.StandardODEProblem}, OrdinaryDiffEq.Tsit5{typeof(OrdinaryDiffEq.trivial_limiter!), typeof(OrdinaryDiffEq.trivial_limiter!), Static.False}, L2Loss{Vector{Float64}, Matrix{Float64}, Nothing, Nothing, Nothing}, Nothing, Tuple{}}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED_NO_TIME), Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing}) (generic function with 1 method)</code></pre><p>This objective function internally is calling the ODE solver to get solutions to test against the data. The keyword arguments are passed directly to the solver. Note that we set <code>maxiters</code> in a way that causes the differential equation solvers to error more quickly when in bad regions of the parameter space, speeding up the process. If the integrator stops early (due to divergence), then those parameters are given an infinite loss, and thus this is a quick way to avoid bad parameters. We set <code>verbose=false</code> because this divergence can get noisy.</p><p>Before optimizing, let&#39;s visualize our cost function by plotting it for a range of parameter values: yscale</p><pre><code class="language-julia hljs">vals = 0.0:0.1:10.0
plot(vals,[cost_function(i) for i in vals],yscale=:log10,
     xaxis = &quot;Parameter&quot;, yaxis = &quot;Cost&quot;, title = &quot;1-Parameter Cost Function&quot;,
     lw = 3)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip650">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip650)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip651">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip650)" d="
M258.387 1423.18 L2352.76 1423.18 L2352.76 123.472 L258.387 123.472  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip652">
    <rect x="258" y="123" width="2095" height="1301"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  317.662,1423.18 317.662,123.472 
  "/>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  811.617,1423.18 811.617,123.472 
  "/>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1305.57,1423.18 1305.57,123.472 
  "/>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1799.53,1423.18 1799.53,123.472 
  "/>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2293.48,1423.18 2293.48,123.472 
  "/>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  258.387,1423.18 2352.76,1423.18 
  "/>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  317.662,1423.18 317.662,1404.28 
  "/>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  811.617,1423.18 811.617,1404.28 
  "/>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1305.57,1423.18 1305.57,1404.28 
  "/>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  1799.53,1423.18 1799.53,1404.28 
  "/>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2293.48,1423.18 2293.48,1404.28 
  "/>
<path clip-path="url(#clip650)" d="M295.046 1454.1 Q291.435 1454.1 289.607 1457.66 Q287.801 1461.2 287.801 1468.33 Q287.801 1475.44 289.607 1479.01 Q291.435 1482.55 295.046 1482.55 Q298.681 1482.55 300.486 1479.01 Q302.315 1475.44 302.315 1468.33 Q302.315 1461.2 300.486 1457.66 Q298.681 1454.1 295.046 1454.1 M295.046 1450.39 Q300.857 1450.39 303.912 1455 Q306.991 1459.58 306.991 1468.33 Q306.991 1477.06 303.912 1481.67 Q300.857 1486.25 295.046 1486.25 Q289.236 1486.25 286.158 1481.67 Q283.102 1477.06 283.102 1468.33 Q283.102 1459.58 286.158 1455 Q289.236 1450.39 295.046 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M315.208 1479.7 L320.093 1479.7 L320.093 1485.58 L315.208 1485.58 L315.208 1479.7 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M340.278 1454.1 Q336.667 1454.1 334.838 1457.66 Q333.032 1461.2 333.032 1468.33 Q333.032 1475.44 334.838 1479.01 Q336.667 1482.55 340.278 1482.55 Q343.912 1482.55 345.717 1479.01 Q347.546 1475.44 347.546 1468.33 Q347.546 1461.2 345.717 1457.66 Q343.912 1454.1 340.278 1454.1 M340.278 1450.39 Q346.088 1450.39 349.143 1455 Q352.222 1459.58 352.222 1468.33 Q352.222 1477.06 349.143 1481.67 Q346.088 1486.25 340.278 1486.25 Q334.468 1486.25 331.389 1481.67 Q328.333 1477.06 328.333 1468.33 Q328.333 1459.58 331.389 1455 Q334.468 1450.39 340.278 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M783.353 1481.64 L799.672 1481.64 L799.672 1485.58 L777.728 1485.58 L777.728 1481.64 Q780.39 1478.89 784.973 1474.26 Q789.58 1469.61 790.76 1468.27 Q793.006 1465.74 793.885 1464.01 Q794.788 1462.25 794.788 1460.56 Q794.788 1457.8 792.844 1456.07 Q790.923 1454.33 787.821 1454.33 Q785.622 1454.33 783.168 1455.09 Q780.737 1455.86 777.96 1457.41 L777.96 1452.69 Q780.784 1451.55 783.237 1450.97 Q785.691 1450.39 787.728 1450.39 Q793.098 1450.39 796.293 1453.08 Q799.487 1455.77 799.487 1460.26 Q799.487 1462.39 798.677 1464.31 Q797.89 1466.2 795.784 1468.8 Q795.205 1469.47 792.103 1472.69 Q789.001 1475.88 783.353 1481.64 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M809.487 1479.7 L814.371 1479.7 L814.371 1485.58 L809.487 1485.58 L809.487 1479.7 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M824.603 1451.02 L842.959 1451.02 L842.959 1454.96 L828.885 1454.96 L828.885 1463.43 Q829.904 1463.08 830.922 1462.92 Q831.941 1462.73 832.959 1462.73 Q838.746 1462.73 842.126 1465.9 Q845.506 1469.08 845.506 1474.49 Q845.506 1480.07 842.033 1483.17 Q838.561 1486.25 832.242 1486.25 Q830.066 1486.25 827.797 1485.88 Q825.552 1485.51 823.145 1484.77 L823.145 1480.07 Q825.228 1481.2 827.45 1481.76 Q829.672 1482.32 832.149 1482.32 Q836.154 1482.32 838.492 1480.21 Q840.83 1478.1 840.83 1474.49 Q840.83 1470.88 838.492 1468.77 Q836.154 1466.67 832.149 1466.67 Q830.274 1466.67 828.399 1467.08 Q826.547 1467.5 824.603 1468.38 L824.603 1451.02 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1272.74 1451.02 L1291.09 1451.02 L1291.09 1454.96 L1277.02 1454.96 L1277.02 1463.43 Q1278.04 1463.08 1279.06 1462.92 Q1280.07 1462.73 1281.09 1462.73 Q1286.88 1462.73 1290.26 1465.9 Q1293.64 1469.08 1293.64 1474.49 Q1293.64 1480.07 1290.17 1483.17 Q1286.69 1486.25 1280.38 1486.25 Q1278.2 1486.25 1275.93 1485.88 Q1273.69 1485.51 1271.28 1484.77 L1271.28 1480.07 Q1273.36 1481.2 1275.58 1481.76 Q1277.81 1482.32 1280.28 1482.32 Q1284.29 1482.32 1286.63 1480.21 Q1288.96 1478.1 1288.96 1474.49 Q1288.96 1470.88 1286.63 1468.77 Q1284.29 1466.67 1280.28 1466.67 Q1278.41 1466.67 1276.53 1467.08 Q1274.68 1467.5 1272.74 1468.38 L1272.74 1451.02 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1302.85 1479.7 L1307.74 1479.7 L1307.74 1485.58 L1302.85 1485.58 L1302.85 1479.7 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1327.92 1454.1 Q1324.31 1454.1 1322.48 1457.66 Q1320.68 1461.2 1320.68 1468.33 Q1320.68 1475.44 1322.48 1479.01 Q1324.31 1482.55 1327.92 1482.55 Q1331.56 1482.55 1333.36 1479.01 Q1335.19 1475.44 1335.19 1468.33 Q1335.19 1461.2 1333.36 1457.66 Q1331.56 1454.1 1327.92 1454.1 M1327.92 1450.39 Q1333.73 1450.39 1336.79 1455 Q1339.87 1459.58 1339.87 1468.33 Q1339.87 1477.06 1336.79 1481.67 Q1333.73 1486.25 1327.92 1486.25 Q1322.11 1486.25 1319.03 1481.67 Q1315.98 1477.06 1315.98 1468.33 Q1315.98 1459.58 1319.03 1455 Q1322.11 1450.39 1327.92 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1765.85 1451.02 L1788.07 1451.02 L1788.07 1453.01 L1775.52 1485.58 L1770.64 1485.58 L1782.44 1454.96 L1765.85 1454.96 L1765.85 1451.02 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1797.19 1479.7 L1802.07 1479.7 L1802.07 1485.58 L1797.19 1485.58 L1797.19 1479.7 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1812.3 1451.02 L1830.66 1451.02 L1830.66 1454.96 L1816.59 1454.96 L1816.59 1463.43 Q1817.61 1463.08 1818.62 1462.92 Q1819.64 1462.73 1820.66 1462.73 Q1826.45 1462.73 1829.83 1465.9 Q1833.21 1469.08 1833.21 1474.49 Q1833.21 1480.07 1829.73 1483.17 Q1826.26 1486.25 1819.94 1486.25 Q1817.77 1486.25 1815.5 1485.88 Q1813.25 1485.51 1810.85 1484.77 L1810.85 1480.07 Q1812.93 1481.2 1815.15 1481.76 Q1817.37 1482.32 1819.85 1482.32 Q1823.86 1482.32 1826.19 1480.21 Q1828.53 1478.1 1828.53 1474.49 Q1828.53 1470.88 1826.19 1468.77 Q1823.86 1466.67 1819.85 1466.67 Q1817.98 1466.67 1816.1 1467.08 Q1814.25 1467.5 1812.3 1468.38 L1812.3 1451.02 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M2245.55 1481.64 L2253.19 1481.64 L2253.19 1455.28 L2244.88 1456.95 L2244.88 1452.69 L2253.15 1451.02 L2257.82 1451.02 L2257.82 1481.64 L2265.46 1481.64 L2265.46 1485.58 L2245.55 1485.58 L2245.55 1481.64 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M2284.9 1454.1 Q2281.29 1454.1 2279.47 1457.66 Q2277.66 1461.2 2277.66 1468.33 Q2277.66 1475.44 2279.47 1479.01 Q2281.29 1482.55 2284.9 1482.55 Q2288.54 1482.55 2290.34 1479.01 Q2292.17 1475.44 2292.17 1468.33 Q2292.17 1461.2 2290.34 1457.66 Q2288.54 1454.1 2284.9 1454.1 M2284.9 1450.39 Q2290.72 1450.39 2293.77 1455 Q2296.85 1459.58 2296.85 1468.33 Q2296.85 1477.06 2293.77 1481.67 Q2290.72 1486.25 2284.9 1486.25 Q2279.09 1486.25 2276.02 1481.67 Q2272.96 1477.06 2272.96 1468.33 Q2272.96 1459.58 2276.02 1455 Q2279.09 1450.39 2284.9 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M2305.07 1479.7 L2309.95 1479.7 L2309.95 1485.58 L2305.07 1485.58 L2305.07 1479.7 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M2330.14 1454.1 Q2326.53 1454.1 2324.7 1457.66 Q2322.89 1461.2 2322.89 1468.33 Q2322.89 1475.44 2324.7 1479.01 Q2326.53 1482.55 2330.14 1482.55 Q2333.77 1482.55 2335.58 1479.01 Q2337.4 1475.44 2337.4 1468.33 Q2337.4 1461.2 2335.58 1457.66 Q2333.77 1454.1 2330.14 1454.1 M2330.14 1450.39 Q2335.95 1450.39 2339 1455 Q2342.08 1459.58 2342.08 1468.33 Q2342.08 1477.06 2339 1481.67 Q2335.95 1486.25 2330.14 1486.25 Q2324.33 1486.25 2321.25 1481.67 Q2318.19 1477.06 2318.19 1468.33 Q2318.19 1459.58 2321.25 1455 Q2324.33 1450.39 2330.14 1450.39 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1145.63 1525.81 L1145.63 1543.66 L1153.72 1543.66 Q1158.21 1543.66 1160.66 1541.34 Q1163.11 1539.02 1163.11 1534.72 Q1163.11 1530.45 1160.66 1528.13 Q1158.21 1525.81 1153.72 1525.81 L1145.63 1525.81 M1139.2 1520.52 L1153.72 1520.52 Q1161.71 1520.52 1165.78 1524.15 Q1169.89 1527.75 1169.89 1534.72 Q1169.89 1541.75 1165.78 1545.35 Q1161.71 1548.95 1153.72 1548.95 L1145.63 1548.95 L1145.63 1568.04 L1139.2 1568.04 L1139.2 1520.52 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1191.53 1550.12 Q1184.43 1550.12 1181.7 1551.75 Q1178.96 1553.37 1178.96 1557.29 Q1178.96 1560.4 1180.99 1562.25 Q1183.06 1564.07 1186.6 1564.07 Q1191.47 1564.07 1194.39 1560.63 Q1197.35 1557.16 1197.35 1551.43 L1197.35 1550.12 L1191.53 1550.12 M1203.21 1547.71 L1203.21 1568.04 L1197.35 1568.04 L1197.35 1562.63 Q1195.35 1565.88 1192.36 1567.44 Q1189.37 1568.97 1185.04 1568.97 Q1179.56 1568.97 1176.32 1565.91 Q1173.1 1562.82 1173.1 1557.67 Q1173.1 1551.65 1177.11 1548.6 Q1181.15 1545.54 1189.14 1545.54 L1197.35 1545.54 L1197.35 1544.97 Q1197.35 1540.93 1194.68 1538.73 Q1192.04 1536.5 1187.23 1536.5 Q1184.18 1536.5 1181.28 1537.23 Q1178.38 1537.97 1175.71 1539.43 L1175.71 1534.02 Q1178.93 1532.78 1181.95 1532.17 Q1184.97 1531.54 1187.84 1531.54 Q1195.57 1531.54 1199.39 1535.55 Q1203.21 1539.56 1203.21 1547.71 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1235.93 1537.87 Q1234.94 1537.3 1233.77 1537.04 Q1232.62 1536.76 1231.22 1536.76 Q1226.25 1536.76 1223.58 1540 Q1220.94 1543.22 1220.94 1549.27 L1220.94 1568.04 L1215.05 1568.04 L1215.05 1532.4 L1220.94 1532.4 L1220.94 1537.93 Q1222.79 1534.69 1225.75 1533.13 Q1228.71 1531.54 1232.94 1531.54 Q1233.54 1531.54 1234.28 1531.63 Q1235.01 1531.7 1235.9 1531.85 L1235.93 1537.87 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1258.27 1550.12 Q1251.18 1550.12 1248.44 1551.75 Q1245.7 1553.37 1245.7 1557.29 Q1245.7 1560.4 1247.74 1562.25 Q1249.81 1564.07 1253.34 1564.07 Q1258.21 1564.07 1261.14 1560.63 Q1264.1 1557.16 1264.1 1551.43 L1264.1 1550.12 L1258.27 1550.12 M1269.96 1547.71 L1269.96 1568.04 L1264.1 1568.04 L1264.1 1562.63 Q1262.09 1565.88 1259.1 1567.44 Q1256.11 1568.97 1251.78 1568.97 Q1246.31 1568.97 1243.06 1565.91 Q1239.85 1562.82 1239.85 1557.67 Q1239.85 1551.65 1243.86 1548.6 Q1247.9 1545.54 1255.89 1545.54 L1264.1 1545.54 L1264.1 1544.97 Q1264.1 1540.93 1261.43 1538.73 Q1258.78 1536.5 1253.98 1536.5 Q1250.92 1536.5 1248.03 1537.23 Q1245.13 1537.97 1242.46 1539.43 L1242.46 1534.02 Q1245.67 1532.78 1248.69 1532.17 Q1251.72 1531.54 1254.58 1531.54 Q1262.32 1531.54 1266.14 1535.55 Q1269.96 1539.56 1269.96 1547.71 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1309.77 1539.24 Q1311.97 1535.29 1315.02 1533.41 Q1318.08 1531.54 1322.22 1531.54 Q1327.79 1531.54 1330.81 1535.45 Q1333.84 1539.33 1333.84 1546.53 L1333.84 1568.04 L1327.95 1568.04 L1327.95 1546.72 Q1327.95 1541.59 1326.13 1539.11 Q1324.32 1536.63 1320.59 1536.63 Q1316.04 1536.63 1313.4 1539.65 Q1310.76 1542.68 1310.76 1547.9 L1310.76 1568.04 L1304.87 1568.04 L1304.87 1546.72 Q1304.87 1541.56 1303.06 1539.11 Q1301.24 1536.63 1297.46 1536.63 Q1292.97 1536.63 1290.33 1539.68 Q1287.68 1542.71 1287.68 1547.9 L1287.68 1568.04 L1281.8 1568.04 L1281.8 1532.4 L1287.68 1532.4 L1287.68 1537.93 Q1289.69 1534.66 1292.49 1533.1 Q1295.29 1531.54 1299.14 1531.54 Q1303.03 1531.54 1305.73 1533.51 Q1308.47 1535.48 1309.77 1539.24 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1376.01 1548.76 L1376.01 1551.62 L1349.08 1551.62 Q1349.46 1557.67 1352.71 1560.85 Q1355.99 1564 1361.81 1564 Q1365.19 1564 1368.34 1563.17 Q1371.52 1562.35 1374.64 1560.69 L1374.64 1566.23 Q1371.49 1567.57 1368.18 1568.27 Q1364.87 1568.97 1361.46 1568.97 Q1352.93 1568.97 1347.94 1564 Q1342.97 1559.04 1342.97 1550.57 Q1342.97 1541.82 1347.68 1536.69 Q1352.42 1531.54 1360.44 1531.54 Q1367.64 1531.54 1371.81 1536.18 Q1376.01 1540.8 1376.01 1548.76 M1370.15 1547.04 Q1370.09 1542.23 1367.45 1539.37 Q1364.84 1536.5 1360.51 1536.5 Q1355.61 1536.5 1352.65 1539.27 Q1349.72 1542.04 1349.27 1547.07 L1370.15 1547.04 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1391.41 1522.27 L1391.41 1532.4 L1403.48 1532.4 L1403.48 1536.95 L1391.41 1536.95 L1391.41 1556.3 Q1391.41 1560.66 1392.59 1561.9 Q1393.8 1563.14 1397.46 1563.14 L1403.48 1563.14 L1403.48 1568.04 L1397.46 1568.04 Q1390.68 1568.04 1388.1 1565.53 Q1385.52 1562.98 1385.52 1556.3 L1385.52 1536.95 L1381.23 1536.95 L1381.23 1532.4 L1385.52 1532.4 L1385.52 1522.27 L1391.41 1522.27 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1441.67 1548.76 L1441.67 1551.62 L1414.74 1551.62 Q1415.13 1557.67 1418.37 1560.85 Q1421.65 1564 1427.47 1564 Q1430.85 1564 1434 1563.17 Q1437.18 1562.35 1440.3 1560.69 L1440.3 1566.23 Q1437.15 1567.57 1433.84 1568.27 Q1430.53 1568.97 1427.12 1568.97 Q1418.59 1568.97 1413.6 1564 Q1408.63 1559.04 1408.63 1550.57 Q1408.63 1541.82 1413.34 1536.69 Q1418.09 1531.54 1426.11 1531.54 Q1433.3 1531.54 1437.47 1536.18 Q1441.67 1540.8 1441.67 1548.76 M1435.81 1547.04 Q1435.75 1542.23 1433.11 1539.37 Q1430.5 1536.5 1426.17 1536.5 Q1421.27 1536.5 1418.31 1539.27 Q1415.38 1542.04 1414.93 1547.07 L1435.81 1547.04 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1471.94 1537.87 Q1470.95 1537.3 1469.78 1537.04 Q1468.63 1536.76 1467.23 1536.76 Q1462.26 1536.76 1459.59 1540 Q1456.95 1543.22 1456.95 1549.27 L1456.95 1568.04 L1451.06 1568.04 L1451.06 1532.4 L1456.95 1532.4 L1456.95 1537.93 Q1458.79 1534.69 1461.75 1533.13 Q1464.71 1531.54 1468.95 1531.54 Q1469.55 1531.54 1470.28 1531.63 Q1471.02 1531.7 1471.91 1531.85 L1471.94 1537.87 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  258.387,1100.57 2352.76,1100.57 
  "/>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  258.387,600.87 2352.76,600.87 
  "/>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  258.387,1423.18 258.387,123.472 
  "/>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  258.387,1100.57 277.285,1100.57 
  "/>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  258.387,600.87 277.285,600.87 
  "/>
<path clip-path="url(#clip650)" d="M114.931 1120.36 L122.57 1120.36 L122.57 1093.99 L114.26 1095.66 L114.26 1091.4 L122.524 1089.73 L127.2 1089.73 L127.2 1120.36 L134.839 1120.36 L134.839 1124.29 L114.931 1124.29 L114.931 1120.36 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M154.283 1092.81 Q150.672 1092.81 148.843 1096.38 Q147.038 1099.92 147.038 1107.05 Q147.038 1114.15 148.843 1117.72 Q150.672 1121.26 154.283 1121.26 Q157.917 1121.26 159.723 1117.72 Q161.552 1114.15 161.552 1107.05 Q161.552 1099.92 159.723 1096.38 Q157.917 1092.81 154.283 1092.81 M154.283 1089.11 Q160.093 1089.11 163.149 1093.71 Q166.227 1098.3 166.227 1107.05 Q166.227 1115.77 163.149 1120.38 Q160.093 1124.96 154.283 1124.96 Q148.473 1124.96 145.394 1120.38 Q142.339 1115.77 142.339 1107.05 Q142.339 1098.3 145.394 1093.71 Q148.473 1089.11 154.283 1089.11 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M175.932 1071.3 Q172.998 1071.3 171.512 1074.2 Q170.045 1077.08 170.045 1082.87 Q170.045 1088.65 171.512 1091.54 Q172.998 1094.42 175.932 1094.42 Q178.885 1094.42 180.352 1091.54 Q181.838 1088.65 181.838 1082.87 Q181.838 1077.08 180.352 1074.2 Q178.885 1071.3 175.932 1071.3 M175.932 1068.3 Q180.653 1068.3 183.136 1072.04 Q185.637 1075.76 185.637 1082.87 Q185.637 1089.96 183.136 1093.7 Q180.653 1097.43 175.932 1097.43 Q171.212 1097.43 168.71 1093.7 Q166.227 1089.96 166.227 1082.87 Q166.227 1075.76 168.71 1072.04 Q171.212 1068.3 175.932 1068.3 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M192.314 1092.11 L196.282 1092.11 L196.282 1096.88 L192.314 1096.88 L192.314 1092.11 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M212.683 1071.3 Q209.749 1071.3 208.263 1074.2 Q206.796 1077.08 206.796 1082.87 Q206.796 1088.65 208.263 1091.54 Q209.749 1094.42 212.683 1094.42 Q215.635 1094.42 217.102 1091.54 Q218.588 1088.65 218.588 1082.87 Q218.588 1077.08 217.102 1074.2 Q215.635 1071.3 212.683 1071.3 M212.683 1068.3 Q217.403 1068.3 219.886 1072.04 Q222.387 1075.76 222.387 1082.87 Q222.387 1089.96 219.886 1093.7 Q217.403 1097.43 212.683 1097.43 Q207.962 1097.43 205.46 1093.7 Q202.978 1089.96 202.978 1082.87 Q202.978 1075.76 205.46 1072.04 Q207.962 1068.3 212.683 1068.3 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M116.022 620.662 L123.661 620.662 L123.661 594.297 L115.351 595.963 L115.351 591.704 L123.615 590.037 L128.291 590.037 L128.291 620.662 L135.93 620.662 L135.93 624.597 L116.022 624.597 L116.022 620.662 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M155.374 593.116 Q151.763 593.116 149.934 596.681 Q148.129 600.223 148.129 607.352 Q148.129 614.459 149.934 618.023 Q151.763 621.565 155.374 621.565 Q159.008 621.565 160.814 618.023 Q162.642 614.459 162.642 607.352 Q162.642 600.223 160.814 596.681 Q159.008 593.116 155.374 593.116 M155.374 589.412 Q161.184 589.412 164.24 594.019 Q167.318 598.602 167.318 607.352 Q167.318 616.079 164.24 620.685 Q161.184 625.269 155.374 625.269 Q149.564 625.269 146.485 620.685 Q143.43 616.079 143.43 607.352 Q143.43 598.602 146.485 594.019 Q149.564 589.412 155.374 589.412 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M171.889 593.99 L185.148 593.99 L185.148 597.187 L167.318 597.187 L167.318 593.99 Q169.481 591.752 173.205 587.99 Q176.948 584.21 177.907 583.119 Q179.731 581.069 180.446 579.658 Q181.18 578.229 181.18 576.856 Q181.18 574.618 179.6 573.207 Q178.039 571.797 175.519 571.797 Q173.732 571.797 171.738 572.417 Q169.763 573.038 167.506 574.298 L167.506 570.461 Q169.801 569.54 171.795 569.069 Q173.788 568.599 175.443 568.599 Q179.807 568.599 182.402 570.781 Q184.998 572.963 184.998 576.611 Q184.998 578.342 184.339 579.903 Q183.7 581.445 181.988 583.551 Q181.518 584.097 178.998 586.711 Q176.478 589.307 171.889 593.99 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M193.123 592.41 L197.091 592.41 L197.091 597.187 L193.123 597.187 L193.123 592.41 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M205.404 569.107 L220.319 569.107 L220.319 572.304 L208.883 572.304 L208.883 579.188 Q209.711 578.906 210.539 578.774 Q211.366 578.624 212.194 578.624 Q216.896 578.624 219.642 581.2 Q222.387 583.777 222.387 588.178 Q222.387 592.711 219.566 595.231 Q216.745 597.732 211.611 597.732 Q209.843 597.732 208 597.432 Q206.175 597.131 204.219 596.529 L204.219 592.711 Q205.912 593.632 207.717 594.084 Q209.523 594.535 211.535 594.535 Q214.789 594.535 216.689 592.824 Q218.588 591.112 218.588 588.178 Q218.588 585.244 216.689 583.533 Q214.789 581.821 211.535 581.821 Q210.012 581.821 208.489 582.16 Q206.984 582.498 205.404 583.213 L205.404 569.107 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M20.1444 804.852 L26.9239 804.852 Q23.9002 808.099 22.4043 811.791 Q20.9083 815.451 20.9083 819.589 Q20.9083 827.737 25.9054 832.066 Q30.8707 836.394 40.2919 836.394 Q49.6813 836.394 54.6784 832.066 Q59.6436 827.737 59.6436 819.589 Q59.6436 815.451 58.1477 811.791 Q56.6518 808.099 53.6281 804.852 L60.3439 804.852 Q62.6355 808.226 63.7814 812.014 Q64.9272 815.769 64.9272 819.971 Q64.9272 830.761 58.3387 836.967 Q51.7183 843.174 40.2919 843.174 Q28.8336 843.174 22.2451 836.967 Q15.6248 830.761 15.6248 819.971 Q15.6248 815.706 16.7706 811.95 Q17.8846 808.162 20.1444 804.852 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M32.4621 781.363 Q32.4621 786.073 36.1542 788.811 Q39.8145 791.548 46.212 791.548 Q52.6095 791.548 56.3017 788.842 Q59.9619 786.105 59.9619 781.363 Q59.9619 776.684 56.2698 773.947 Q52.5777 771.209 46.212 771.209 Q39.8781 771.209 36.186 773.947 Q32.4621 776.684 32.4621 781.363 M27.4968 781.363 Q27.4968 773.724 32.4621 769.363 Q37.4273 765.003 46.212 765.003 Q54.9649 765.003 59.9619 769.363 Q64.9272 773.724 64.9272 781.363 Q64.9272 789.033 59.9619 793.394 Q54.9649 797.723 46.212 797.723 Q37.4273 797.723 32.4621 793.394 Q27.4968 789.033 27.4968 781.363 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M29.4065 732.57 L34.9447 732.57 Q33.6716 735.052 33.035 737.726 Q32.3984 740.399 32.3984 743.264 Q32.3984 747.624 33.7352 749.821 Q35.072 751.985 37.7456 751.985 Q39.7826 751.985 40.9603 750.425 Q42.1061 748.866 43.1565 744.155 L43.6021 742.15 Q44.9389 735.912 47.3897 733.302 Q49.8086 730.66 54.1691 730.66 Q59.1344 730.66 62.0308 734.607 Q64.9272 738.521 64.9272 745.396 Q64.9272 748.261 64.3543 751.38 Q63.8132 754.468 62.6992 757.905 L56.6518 757.905 Q58.3387 754.659 59.198 751.508 Q60.0256 748.356 60.0256 745.269 Q60.0256 741.131 58.6251 738.903 Q57.1929 736.675 54.6147 736.675 Q52.2276 736.675 50.9545 738.299 Q49.6813 739.89 48.5037 745.333 L48.0262 747.37 Q46.8804 752.812 44.5251 755.231 Q42.138 757.65 38.0002 757.65 Q32.9713 757.65 30.2341 754.086 Q27.4968 750.521 27.4968 743.964 Q27.4968 740.718 27.9743 737.853 Q28.4517 734.989 29.4065 732.57 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M18.2347 715.541 L28.3562 715.541 L28.3562 703.478 L32.9077 703.478 L32.9077 715.541 L52.2594 715.541 Q56.6199 715.541 57.8613 714.364 Q59.1026 713.154 59.1026 709.494 L59.1026 703.478 L64.0042 703.478 L64.0042 709.494 Q64.0042 716.273 61.4897 718.851 Q58.9434 721.43 52.2594 721.43 L32.9077 721.43 L32.9077 725.726 L28.3562 725.726 L28.3562 721.43 L18.2347 721.43 L18.2347 715.541 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M762.629 65.6895 L775.997 65.6895 L775.997 19.5497 L761.454 22.4663 L761.454 15.0127 L775.916 12.096 L784.099 12.096 L784.099 65.6895 L797.467 65.6895 L797.467 72.576 L762.629 72.576 L762.629 65.6895 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M809.174 46.5287 L831.008 46.5287 L831.008 53.1722 L809.174 53.1722 L809.174 46.5287 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M851.384 18.8205 L851.384 41.5461 L861.674 41.5461 Q867.385 41.5461 870.505 38.5889 Q873.624 35.6318 873.624 30.163 Q873.624 24.7348 870.505 21.7777 Q867.385 18.8205 861.674 18.8205 L851.384 18.8205 M843.201 12.096 L861.674 12.096 Q871.841 12.096 877.027 16.714 Q882.252 21.2916 882.252 30.163 Q882.252 39.1155 877.027 43.6931 Q871.841 48.2706 861.674 48.2706 L851.384 48.2706 L851.384 72.576 L843.201 72.576 L843.201 12.096 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M909.798 49.7694 Q900.765 49.7694 897.281 51.8354 Q893.797 53.9013 893.797 58.8839 Q893.797 62.8538 896.39 65.2034 Q899.023 67.5124 903.519 67.5124 Q909.717 67.5124 913.444 63.1374 Q917.212 58.7219 917.212 51.4303 L917.212 49.7694 L909.798 49.7694 M924.665 46.6907 L924.665 72.576 L917.212 72.576 L917.212 65.6895 Q914.659 69.8214 910.852 71.8063 Q907.044 73.7508 901.535 73.7508 Q894.567 73.7508 890.435 69.8619 Q886.344 65.9325 886.344 59.3701 Q886.344 51.7138 891.448 47.825 Q896.592 43.9361 906.76 43.9361 L917.212 43.9361 L917.212 43.2069 Q917.212 38.0623 913.809 35.2672 Q910.446 32.4315 904.33 32.4315 Q900.441 32.4315 896.754 33.3632 Q893.068 34.295 889.665 36.1584 L889.665 29.2718 Q893.757 27.692 897.605 26.9223 Q901.453 26.1121 905.099 26.1121 Q914.943 26.1121 919.804 31.2163 Q924.665 36.3204 924.665 46.6907 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M966.308 34.1734 Q965.053 33.4443 963.554 33.1202 Q962.096 32.7556 960.313 32.7556 Q953.994 32.7556 950.591 36.8875 Q947.229 40.9789 947.229 48.6757 L947.229 72.576 L939.735 72.576 L939.735 27.2059 L947.229 27.2059 L947.229 34.2544 Q949.578 30.1225 953.346 28.1376 Q957.113 26.1121 962.501 26.1121 Q963.27 26.1121 964.202 26.2337 Q965.134 26.3147 966.268 26.5172 L966.308 34.1734 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M994.746 49.7694 Q985.712 49.7694 982.229 51.8354 Q978.745 53.9013 978.745 58.8839 Q978.745 62.8538 981.337 65.2034 Q983.97 67.5124 988.467 67.5124 Q994.665 67.5124 998.392 63.1374 Q1002.16 58.7219 1002.16 51.4303 L1002.16 49.7694 L994.746 49.7694 M1009.61 46.6907 L1009.61 72.576 L1002.16 72.576 L1002.16 65.6895 Q999.607 69.8214 995.799 71.8063 Q991.991 73.7508 986.482 73.7508 Q979.514 73.7508 975.382 69.8619 Q971.291 65.9325 971.291 59.3701 Q971.291 51.7138 976.395 47.825 Q981.54 43.9361 991.708 43.9361 L1002.16 43.9361 L1002.16 43.2069 Q1002.16 38.0623 998.756 35.2672 Q995.394 32.4315 989.277 32.4315 Q985.388 32.4315 981.702 33.3632 Q978.016 34.295 974.613 36.1584 L974.613 29.2718 Q978.704 27.692 982.553 26.9223 Q986.401 26.1121 990.047 26.1121 Q999.89 26.1121 1004.75 31.2163 Q1009.61 36.3204 1009.61 46.6907 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1060.29 35.9153 Q1063.08 30.8922 1066.97 28.5022 Q1070.86 26.1121 1076.13 26.1121 Q1083.22 26.1121 1087.07 31.0947 Q1090.91 36.0368 1090.91 45.1919 L1090.91 72.576 L1083.42 72.576 L1083.42 45.4349 Q1083.42 38.913 1081.11 35.7533 Q1078.8 32.5936 1074.06 32.5936 Q1068.27 32.5936 1064.91 36.4419 Q1061.55 40.2903 1061.55 46.9338 L1061.55 72.576 L1054.05 72.576 L1054.05 45.4349 Q1054.05 38.8725 1051.74 35.7533 Q1049.43 32.5936 1044.61 32.5936 Q1038.9 32.5936 1035.54 36.4824 Q1032.18 40.3308 1032.18 46.9338 L1032.18 72.576 L1024.68 72.576 L1024.68 27.2059 L1032.18 27.2059 L1032.18 34.2544 Q1034.73 30.082 1038.29 28.0971 Q1041.86 26.1121 1046.76 26.1121 Q1051.7 26.1121 1055.14 28.6237 Q1058.63 31.1352 1060.29 35.9153 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1144.59 48.0275 L1144.59 51.6733 L1110.32 51.6733 Q1110.8 59.3701 1114.94 63.421 Q1119.11 67.4314 1126.52 67.4314 Q1130.82 67.4314 1134.83 66.3781 Q1138.88 65.3249 1142.85 63.2184 L1142.85 70.267 Q1138.84 71.9684 1134.62 72.8596 Q1130.41 73.7508 1126.08 73.7508 Q1115.22 73.7508 1108.86 67.4314 Q1102.54 61.1119 1102.54 50.3365 Q1102.54 39.1965 1108.54 32.6746 Q1114.57 26.1121 1124.78 26.1121 Q1133.93 26.1121 1139.24 32.0264 Q1144.59 37.9003 1144.59 48.0275 M1137.14 45.84 Q1137.05 39.7232 1133.69 36.0774 Q1130.37 32.4315 1124.86 32.4315 Q1118.62 32.4315 1114.86 35.9558 Q1111.13 39.4801 1110.56 45.8805 L1137.14 45.84 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1164.2 14.324 L1164.2 27.2059 L1179.55 27.2059 L1179.55 32.9987 L1164.2 32.9987 L1164.2 57.6282 Q1164.2 63.1779 1165.69 64.7578 Q1167.23 66.3376 1171.89 66.3376 L1179.55 66.3376 L1179.55 72.576 L1171.89 72.576 Q1163.26 72.576 1159.98 69.3758 Q1156.7 66.1351 1156.7 57.6282 L1156.7 32.9987 L1151.23 32.9987 L1151.23 27.2059 L1156.7 27.2059 L1156.7 14.324 L1164.2 14.324 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1228.16 48.0275 L1228.16 51.6733 L1193.89 51.6733 Q1194.37 59.3701 1198.51 63.421 Q1202.68 67.4314 1210.09 67.4314 Q1214.39 67.4314 1218.4 66.3781 Q1222.45 65.3249 1226.42 63.2184 L1226.42 70.267 Q1222.41 71.9684 1218.19 72.8596 Q1213.98 73.7508 1209.65 73.7508 Q1198.79 73.7508 1192.43 67.4314 Q1186.11 61.1119 1186.11 50.3365 Q1186.11 39.1965 1192.11 32.6746 Q1198.14 26.1121 1208.35 26.1121 Q1217.51 26.1121 1222.81 32.0264 Q1228.16 37.9003 1228.16 48.0275 M1220.71 45.84 Q1220.62 39.7232 1217.26 36.0774 Q1213.94 32.4315 1208.43 32.4315 Q1202.19 32.4315 1198.43 35.9558 Q1194.7 39.4801 1194.13 45.8805 L1220.71 45.84 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1266.68 34.1734 Q1265.43 33.4443 1263.93 33.1202 Q1262.47 32.7556 1260.69 32.7556 Q1254.37 32.7556 1250.97 36.8875 Q1247.6 40.9789 1247.6 48.6757 L1247.6 72.576 L1240.11 72.576 L1240.11 27.2059 L1247.6 27.2059 L1247.6 34.2544 Q1249.95 30.1225 1253.72 28.1376 Q1257.49 26.1121 1262.88 26.1121 Q1263.64 26.1121 1264.58 26.2337 Q1265.51 26.3147 1266.64 26.5172 L1266.68 34.1734 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1346.49 16.7545 L1346.49 25.383 Q1342.35 21.5346 1337.65 19.6307 Q1333 17.7268 1327.73 17.7268 Q1317.36 17.7268 1311.85 24.0867 Q1306.34 30.4061 1306.34 42.3968 Q1306.34 54.3469 1311.85 60.7069 Q1317.36 67.0263 1327.73 67.0263 Q1333 67.0263 1337.65 65.1223 Q1342.35 63.2184 1346.49 59.3701 L1346.49 67.9175 Q1342.19 70.8341 1337.37 72.2924 Q1332.59 73.7508 1327.24 73.7508 Q1313.51 73.7508 1305.61 65.3654 Q1297.71 56.9395 1297.71 42.3968 Q1297.71 27.8135 1305.61 19.4281 Q1313.51 11.0023 1327.24 11.0023 Q1332.67 11.0023 1337.45 12.4606 Q1342.27 13.8784 1346.49 16.7545 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1376.38 32.4315 Q1370.39 32.4315 1366.9 37.1306 Q1363.42 41.7891 1363.42 49.9314 Q1363.42 58.0738 1366.86 62.7728 Q1370.35 67.4314 1376.38 67.4314 Q1382.34 67.4314 1385.82 62.7323 Q1389.3 58.0333 1389.3 49.9314 Q1389.3 41.8701 1385.82 37.1711 Q1382.34 32.4315 1376.38 32.4315 M1376.38 26.1121 Q1386.1 26.1121 1391.65 32.4315 Q1397.2 38.7509 1397.2 49.9314 Q1397.2 61.0714 1391.65 67.4314 Q1386.1 73.7508 1376.38 73.7508 Q1366.62 73.7508 1361.07 67.4314 Q1355.56 61.0714 1355.56 49.9314 Q1355.56 38.7509 1361.07 32.4315 Q1366.62 26.1121 1376.38 26.1121 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1438.48 28.5427 L1438.48 35.5912 Q1435.32 33.9709 1431.92 33.1607 Q1428.52 32.3505 1424.87 32.3505 Q1419.32 32.3505 1416.53 34.0519 Q1413.77 35.7533 1413.77 39.156 Q1413.77 41.7486 1415.76 43.2475 Q1417.74 44.7058 1423.74 46.0426 L1426.29 46.6097 Q1434.23 48.3111 1437.55 51.4303 Q1440.91 54.509 1440.91 60.0587 Q1440.91 66.3781 1435.89 70.0644 Q1430.91 73.7508 1422.16 73.7508 Q1418.51 73.7508 1414.54 73.0216 Q1410.61 72.3329 1406.24 70.9151 L1406.24 63.2184 Q1410.37 65.3654 1414.38 66.4591 Q1418.39 67.5124 1422.32 67.5124 Q1427.58 67.5124 1430.42 65.73 Q1433.26 63.9071 1433.26 60.6258 Q1433.26 57.5877 1431.19 55.9673 Q1429.16 54.3469 1422.24 52.8481 L1419.65 52.2405 Q1412.72 50.7821 1409.64 47.7845 Q1406.56 44.7463 1406.56 39.4801 Q1406.56 33.0797 1411.1 29.5959 Q1415.63 26.1121 1423.98 26.1121 Q1428.11 26.1121 1431.76 26.7198 Q1435.4 27.3274 1438.48 28.5427 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1460.15 14.324 L1460.15 27.2059 L1475.51 27.2059 L1475.51 32.9987 L1460.15 32.9987 L1460.15 57.6282 Q1460.15 63.1779 1461.65 64.7578 Q1463.19 66.3376 1467.85 66.3376 L1475.51 66.3376 L1475.51 72.576 L1467.85 72.576 Q1459.22 72.576 1455.94 69.3758 Q1452.66 66.1351 1452.66 57.6282 L1452.66 32.9987 L1447.19 32.9987 L1447.19 27.2059 L1452.66 27.2059 L1452.66 14.324 L1460.15 14.324 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1512.01 12.096 L1546.76 12.096 L1546.76 18.9825 L1520.19 18.9825 L1520.19 36.8065 L1544.17 36.8065 L1544.17 43.6931 L1520.19 43.6931 L1520.19 72.576 L1512.01 72.576 L1512.01 12.096 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1554.09 54.671 L1554.09 27.2059 L1561.55 27.2059 L1561.55 54.3874 Q1561.55 60.8284 1564.06 64.0691 Q1566.57 67.2693 1571.59 67.2693 Q1577.63 67.2693 1581.11 63.421 Q1584.64 59.5726 1584.64 52.9291 L1584.64 27.2059 L1592.09 27.2059 L1592.09 72.576 L1584.64 72.576 L1584.64 65.6084 Q1581.92 69.7404 1578.32 71.7658 Q1574.75 73.7508 1570.01 73.7508 Q1562.2 73.7508 1558.15 68.8897 Q1554.09 64.0286 1554.09 54.671 M1572.85 26.1121 L1572.85 26.1121 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1645.16 45.1919 L1645.16 72.576 L1637.71 72.576 L1637.71 45.4349 Q1637.71 38.994 1635.19 35.7938 Q1632.68 32.5936 1627.66 32.5936 Q1621.62 32.5936 1618.14 36.4419 Q1614.66 40.2903 1614.66 46.9338 L1614.66 72.576 L1607.16 72.576 L1607.16 27.2059 L1614.66 27.2059 L1614.66 34.2544 Q1617.33 30.163 1620.93 28.1376 Q1624.58 26.1121 1629.32 26.1121 Q1637.14 26.1121 1641.15 30.9732 Q1645.16 35.7938 1645.16 45.1919 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1692.68 28.9478 L1692.68 35.9153 Q1689.52 34.1734 1686.32 33.3227 Q1683.16 32.4315 1679.92 32.4315 Q1672.66 32.4315 1668.65 37.0496 Q1664.64 41.6271 1664.64 49.9314 Q1664.64 58.2358 1668.65 62.8538 Q1672.66 67.4314 1679.92 67.4314 Q1683.16 67.4314 1686.32 66.5807 Q1689.52 65.6895 1692.68 63.9476 L1692.68 70.8341 Q1689.56 72.2924 1686.19 73.0216 Q1682.87 73.7508 1679.11 73.7508 Q1668.86 73.7508 1662.82 67.3098 Q1656.79 60.8689 1656.79 49.9314 Q1656.79 38.832 1662.86 32.472 Q1668.98 26.1121 1679.59 26.1121 Q1683.03 26.1121 1686.32 26.8413 Q1689.6 27.5299 1692.68 28.9478 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1713.01 14.324 L1713.01 27.2059 L1728.36 27.2059 L1728.36 32.9987 L1713.01 32.9987 L1713.01 57.6282 Q1713.01 63.1779 1714.51 64.7578 Q1716.05 66.3376 1720.71 66.3376 L1728.36 66.3376 L1728.36 72.576 L1720.71 72.576 Q1712.08 72.576 1708.8 69.3758 Q1705.52 66.1351 1705.52 57.6282 L1705.52 32.9987 L1700.05 32.9987 L1700.05 27.2059 L1705.52 27.2059 L1705.52 14.324 L1713.01 14.324 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1738.17 27.2059 L1745.62 27.2059 L1745.62 72.576 L1738.17 72.576 L1738.17 27.2059 M1738.17 9.54393 L1745.62 9.54393 L1745.62 18.9825 L1738.17 18.9825 L1738.17 9.54393 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1778.8 32.4315 Q1772.8 32.4315 1769.32 37.1306 Q1765.84 41.7891 1765.84 49.9314 Q1765.84 58.0738 1769.28 62.7728 Q1772.76 67.4314 1778.8 67.4314 Q1784.75 67.4314 1788.24 62.7323 Q1791.72 58.0333 1791.72 49.9314 Q1791.72 41.8701 1788.24 37.1711 Q1784.75 32.4315 1778.8 32.4315 M1778.8 26.1121 Q1788.52 26.1121 1794.07 32.4315 Q1799.62 38.7509 1799.62 49.9314 Q1799.62 61.0714 1794.07 67.4314 Q1788.52 73.7508 1778.8 73.7508 Q1769.04 73.7508 1763.49 67.4314 Q1757.98 61.0714 1757.98 49.9314 Q1757.98 38.7509 1763.49 32.4315 Q1769.04 26.1121 1778.8 26.1121 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M1849.69 45.1919 L1849.69 72.576 L1842.24 72.576 L1842.24 45.4349 Q1842.24 38.994 1839.72 35.7938 Q1837.21 32.5936 1832.19 32.5936 Q1826.15 32.5936 1822.67 36.4419 Q1819.19 40.2903 1819.19 46.9338 L1819.19 72.576 L1811.69 72.576 L1811.69 27.2059 L1819.19 27.2059 L1819.19 34.2544 Q1821.86 30.163 1825.46 28.1376 Q1829.11 26.1121 1833.85 26.1121 Q1841.67 26.1121 1845.68 30.9732 Q1849.69 35.7938 1849.69 45.1919 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip652)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="
  317.662,413.951 337.42,426.243 357.178,436.975 376.937,447.924 396.695,416.241 416.453,455.895 436.211,425.782 455.969,425.976 475.728,431.47 495.486,411.208 
  515.244,411.092 535.002,420.746 554.76,435.315 574.519,474.284 594.277,573.466 614.035,1386.4 633.793,585.173 653.551,489.697 673.31,444.833 693.068,418.533 
  712.826,399.746 732.584,385.984 752.342,377.986 772.1,374.296 791.859,374.758 811.617,377.644 831.375,380.858 851.133,382.24 870.891,380.559 890.65,376.283 
  910.408,371.112 930.166,366.072 949.924,361.091 969.682,356.217 989.441,350.698 1009.2,344.562 1028.96,338.312 1048.72,331.923 1068.47,325.803 1088.23,320.511 
  1107.99,316.165 1127.75,312.087 1147.51,309.485 1167.26,306.615 1187.02,304.293 1206.78,301.745 1226.54,299.44 1246.3,297.031 1266.06,294.937 1285.81,292.79 
  1305.57,290.254 1325.33,287.855 1345.09,284.688 1364.85,281.128 1384.6,278.04 1404.36,275.22 1424.12,271.841 1443.88,268.619 1463.64,264.905 1483.4,261.69 
  1503.15,258.801 1522.91,255.452 1542.67,252.3 1562.43,249.369 1582.19,246.224 1601.94,243.145 1621.7,239.963 1641.46,236.782 1661.22,233.513 1680.98,229.99 
  1700.74,227.173 1720.49,224.02 1740.25,220.273 1760.01,217.284 1779.77,214.061 1799.53,211.012 1819.28,208.155 1839.04,205.314 1858.8,202.667 1878.56,200.209 
  1898.32,197.99 1918.08,195.955 1937.83,193.97 1957.59,191.833 1977.35,189.144 1997.11,187.774 2016.87,184.973 2036.62,182.717 2056.38,180.46 2076.14,179.273 
  2095.9,176.457 2115.66,174.643 2135.42,173.022 2155.17,170.437 2174.93,168.802 2194.69,167.269 2214.45,165.721 2234.21,164.468 2253.96,162.783 2273.72,161.098 
  2293.48,160.256 
  "/>
<path clip-path="url(#clip650)" d="
M2021.08 270.476 L2282.94 270.476 L2282.94 166.796 L2021.08 166.796  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="
  2021.08,270.476 2282.94,270.476 2282.94,166.796 2021.08,166.796 2021.08,270.476 
  "/>
<polyline clip-path="url(#clip650)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="
  2044.35,218.636 2183.97,218.636 
  "/>
<path clip-path="url(#clip650)" d="M2221.09 238.323 Q2219.28 242.953 2217.57 244.365 Q2215.85 245.777 2212.98 245.777 L2209.58 245.777 L2209.58 242.212 L2212.08 242.212 Q2213.84 242.212 2214.81 241.379 Q2215.78 240.545 2216.96 237.443 L2217.73 235.499 L2207.24 209.99 L2211.76 209.99 L2219.86 230.268 L2227.96 209.99 L2232.47 209.99 L2221.09 238.323 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip650)" d="M2239.77 231.981 L2247.4 231.981 L2247.4 205.615 L2239.09 207.282 L2239.09 203.022 L2247.36 201.356 L2252.03 201.356 L2252.03 231.981 L2259.67 231.981 L2259.67 235.916 L2239.77 235.916 L2239.77 231.981 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /></svg>
<p>Here we see that there is a very well-defined minimum in our cost function at the real parameter (because this is where the solution almost exactly fits the dataset).</p><p>Now this cost function can be used with Optim.jl in order to get the parameters. For example, we can use Brent&#39;s algorithm to search for the best solution on the interval <code>[0,10]</code> by:</p><pre><code class="language-julia hljs">using Optim
result = optimize(cost_function, 0.0, 10.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Results of Optimization Algorithm
 * Algorithm: Brent&#39;s Method
 * Search Interval: [0.000000, 10.000000]
 * Minimizer: 1.500013e+00
 * Minimum: 3.714469e-02
 * Iterations: 22
 * Convergence: max(|x - x_upper|, |x - x_lower|) &lt;= 2*(1.5e-08*|x|+2.2e-16): true
 * Objective Function Calls: 23</code></pre><p>This returns <code>result.minimizer[1]==1.5</code> as the best parameter to match the data. When we plot the fitted equation on the data, we receive the following:</p><p><img src="../../assets/paramest_fit.png" alt="Parameter Estimation Fit"/></p><p>Thus we see that after fitting, the lines match up with the generated data and receive the right parameter value.</p><p>We can also use the multivariate optimization functions. For example, we can use the <code>BFGS</code> algorithm to optimize the parameter starting at <code>a=1.42</code>. By default, Optim.jl only uses ForwardDiff to generate the derivatives, but with the Optimization.jl interface that decouples the derivative generation from the optimization library we can use any library we want. Here we use Zygote.jl to generate the derivatives:</p><pre><code class="language- hljs">cost_function = build_loss_objective(prob, Tsit5(), L2Loss(t,data), Optimization.AutoZygote(),
                                      maxiters=10000,verbose=false)
optprob = Optimization.OptimizationProblem(cost_function, [1.42])
result = solve(optprob, BFGS())</code></pre><p>Note that some of the algorithms may be sensitive to the initial condition. For more details on using Optim.jl, see the <a href="https://julianlsolvers.github.io/Optim.jl/stable/">documentation for Optim.jl</a>. We can improve our solution by noting that the Lotka-Volterra equation requires that the parameters are positive. Thus <a href="https://julianlsolvers.github.io/Optim.jl/stable/#user/minimization/#box-constrained-optimization">following the Optim.jl documentation</a> we can add box constraints to ensure the optimizer only checks between 0.0 and 3.0 which improves the efficiency of our algorithm. We pass the <code>lb</code> and <code>ub</code> keyword arguments to the <code>OptimizationProblem</code> to pass these bounds to the optimizer:</p><pre><code class="language-julia hljs">lower = [0.0]
upper = [3.0]
optprob = Optimization.OptimizationProblem(cost_function, [1.42], lb = lower, ub = upper)
result = solve(optprob, BFGS())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">u: 1-element Vector{Float64}:
 1.5000132273560198</code></pre><p>Lastly, we can use the same tools to estimate multiple parameters simultaneously. Let&#39;s use the Lotka-Volterra equation with all parameters free:</p><pre><code class="language-julia hljs">function f2(du,u,p,t)
  du[1] = dx = p[1]*u[1] - p[2]*u[1]*u[2]
  du[2] = dy = -p[3]*u[2] + p[4]*u[1]*u[2]
end

u0 = [1.0;1.0]
tspan = (0.0,10.0)
p = [1.5,1.0,3.0,1.0]
prob = ODEProblem(f2,u0,tspan,p)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ODEProblem with uType Vector{Float64} and tType Float64. In-place: true
timespan: (0.0, 10.0)
u0: 2-element Vector{Float64}:
 1.0
 1.0</code></pre><p>We can build an objective function and solve the multiple parameter version just as before:</p><pre><code class="language- hljs">optprob = Optimization.OptimizationProblem(cost_function, [1.3,0.8,2.8,1.2])
result_bfgs = solve(optprob, BFGS())</code></pre><p>We can also use First-Differences in L2Loss by passing the kwarg <code>differ_weight</code> which decides the contribution of the differencing loss to the total loss.</p><pre><code class="language- hljs">cost_function = build_loss_objective(prob,Tsit5(),L2Loss(t,data,differ_weight=0.3,data_weight=0.7), Optimization.AutoZygote(),
                                      maxiters=10000,verbose=false)
optprob = OptimizationProblem(cost_function, [1.3,0.8,2.8,1.2])
result_bfgs = solve(optprob, BFGS())</code></pre><p>We can also use Multiple Shooting method by creating a <code>multiple_shooting_objective</code></p><pre><code class="language-julia hljs">function ms_f(du,u,p,t)
  dx = p[1]*u[1] - p[2]*u[1]*u[2]
  dy = -3*u[2] + u[1]*u[2]
end
ms_u0 = [1.0;1.0]
tspan = (0.0,10.0)
ms_p = [1.5,1.0]
ms_prob = ODEProblem(ms_f,ms_u0,tspan,ms_p)
t = collect(range(0,stop=10,length=200))
data = Array(solve(ms_prob,Tsit5(),saveat=t,abstol=1e-12,reltol=1e-12))
bound = Tuple{Float64, Float64}[(0, 10),(0, 10),(0, 10),(0, 10),
                                (0, 10),(0, 10),(0, 10),(0, 10),
                                (0, 10),(0, 10),(0, 10),(0, 10),
                                (0, 10),(0, 10),(0, 10),(0, 10),(0, 10),(0, 10)]


ms_obj = multiple_shooting_objective(ms_prob, Tsit5(), L2Loss(t, data), Optimization.AutoZygote(); discontinuity_weight = 1.0, abstol = 1e-12, reltol = 1e-12)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(::SciMLBase.OptimizationFunction{true, Optimization.AutoZygote, DiffEqParamEstim.var&quot;#43#48&quot;{Nothing, Float64, DiffEqParamEstim.var&quot;#1#2&quot;, Base.Pairs{Symbol, Float64, Tuple{Symbol, Symbol}, NamedTuple{(:abstol, :reltol), Tuple{Float64, Float64}}}, SciMLBase.ODEProblem{Vector{Float64}, Tuple{Float64, Float64}, true, Vector{Float64}, SciMLBase.ODEFunction{true, SciMLBase.AutoSpecialize, typeof(Main.ms_f), LinearAlgebra.UniformScaling{Bool}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED), Nothing, Nothing}, Base.Pairs{Symbol, Union{}, Tuple{}, NamedTuple{(), Tuple{}}}, SciMLBase.StandardODEProblem}, OrdinaryDiffEq.Tsit5{typeof(OrdinaryDiffEq.trivial_limiter!), typeof(OrdinaryDiffEq.trivial_limiter!), Static.False}, L2Loss{Vector{Float64}, Matrix{Float64}, Nothing, Nothing, Nothing}, Nothing}, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, typeof(SciMLBase.DEFAULT_OBSERVED_NO_TIME), Nothing, Nothing, Nothing, Nothing, Nothing, Nothing, Nothing}) (generic function with 1 method)</code></pre><p>This creates the objective function that can be passed to an optimizer from which we can then get the parameter values and the initial values of the short time periods keeping in mind the indexing.</p><pre><code class="language-julia hljs">result = bboptimize(ms_obj; SearchRange = bound, MaxSteps = 21e3)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">BlackBoxOptim.OptimizationResults(&quot;adaptive_de_rand_1_bin_radiuslimited&quot;, &quot;Max number of steps (21000) reached&quot;, 21001, 1.671619050875083e9, 5.032428026199341, BlackBoxOptim.ParamsDictChain[BlackBoxOptim.ParamsDictChain[Dict{Symbol, Any}(:RngSeed =&gt; 490402, :SearchRange =&gt; [(0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0), (0.0, 10.0)], :MaxSteps =&gt; 21000),Dict{Symbol, Any}()],Dict{Symbol, Any}(:CallbackInterval =&gt; -1.0, :TargetFitness =&gt; nothing, :TraceMode =&gt; :compact, :FitnessScheme =&gt; BlackBoxOptim.ScalarFitnessScheme{true}(), :MinDeltaFitnessTolerance =&gt; 1.0e-50, :NumDimensions =&gt; :NotSpecified, :FitnessTolerance =&gt; 1.0e-8, :TraceInterval =&gt; 0.5, :MaxStepsWithoutProgress =&gt; 10000, :MaxSteps =&gt; 10000…)], 21097, BlackBoxOptim.ScalarFitnessScheme{true}(), BlackBoxOptim.TopListArchiveOutput{Float64, Vector{Float64}}(1.5232211170950243e-6, [0.9999000696981777, 0.9999313467741652, 0.9999428958147442, 0.9999807860432965, 0.9999450142996281, 1.000013519402896, 0.9999278476500981, 0.9999900398097971, 1.0000986150494073, 1.0000083954044834, 0.9999267138948642, 1.0000718511849493, 1.0000358681032853, 1.000006118597037, 0.9998991006098084, 1.0000050630232002, 7.312152719349321, 9.348955622995557]), BlackBoxOptim.PopulationOptimizerOutput{BlackBoxOptim.FitPopulation{Float64}}(BlackBoxOptim.FitPopulation{Float64}([1.0000150436310147 1.0000945167515891 … 1.0000647663563196 1.0000201927621286; 0.9997915546286034 0.9998436090550761 … 1.0000023412246808 0.9998193321765791; … ; 8.040521509784636 8.057234502754206 … 7.856220590896255 7.940705293954662; 8.324466661428428 9.741329362141409 … 8.599878084992234 8.339329394018907], NaN, [5.674450357305484e-6, 3.1397641937081585e-6, 5.704690652568686e-6, 3.923722222818676e-6, 4.926203830960375e-6, 5.17269030071025e-6, 3.245751588543149e-6, 2.94167974249286e-6, 2.811223183421991e-6, 2.2856995063888996e-6  …  7.890291490043836e-6, 8.037505062005933e-6, 1.0960997832465558e-5, 8.327559430425385e-6, 1.0219956428105862e-5, 4.453297284735072e-6, 5.7377961083193875e-6, 1.03861025898913e-5, 4.400369682146259e-6, 6.694395864671825e-6], 0, BlackBoxOptim.Candidate{Float64}[BlackBoxOptim.Candidate{Float64}([1.0000268193716348, 0.9998372315940952, 0.9996736796401497, 0.9998935869887745, 1.000174396086397, 1.0002968542193573, 1.0001320415019355, 1.0000380364724688, 1.0003774604868179, 0.9999887520343876, 1.0002139662588525, 1.0003216019200882, 0.9999967634546776, 0.9998463254425985, 0.9998808444043138, 1.000053381642593, 5.736101966562185, 8.302278575896453], 26, 1.5914829959549516e-5, BlackBoxOptim.AdaptiveDiffEvoRandBin{3}(BlackBoxOptim.AdaptiveDiffEvoParameters(BlackBoxOptim.BimodalCauchy(Distributions.Cauchy{Float64}(μ=0.65, σ=0.1), Distributions.Cauchy{Float64}(μ=1.0, σ=0.1), 0.5, false, true), BlackBoxOptim.BimodalCauchy(Distributions.Cauchy{Float64}(μ=0.1, σ=0.1), Distributions.Cauchy{Float64}(μ=0.95, σ=0.1), 0.5, false, true), [1.0, 0.5765486522654429, 1.0, 0.913625942341414, 0.5242504320023261, 0.6633747249867848, 0.608058678048411, 0.5673376126836491, 0.9315060474240002, 0.7033586383198744  …  0.7205390915576921, 1.0, 1.0, 0.6935959388635117, 1.0, 0.2859949275768689, 1.0, 0.6237900962821951, 0.48828185423539194, 0.6755089258410896], [0.931788282108987, 1.0, 0.5627505779869137, 0.9107404867348652, 0.21432678745690192, 1.0, 0.9642403477472526, 0.20361939628553827, 0.9817914515012881, 0.06603880596474401  …  0.6991833158712031, 0.10178800015506398, 1.0, 0.06062886642091275, 0.9338435973530369, 0.08004718680336753, 0.035056950633262585, 1.0, 0.37734628632213585, 0.14976610725479508])), 0), BlackBoxOptim.Candidate{Float64}([1.0000268193716348, 0.9998372315940952, 0.9996736796401497, 0.9998935869887745, 1.0002952753381038, 1.0002968542193573, 1.0001320415019355, 1.0000380364724688, 1.0003774604868179, 0.9999887520343876, 1.0002139662588525, 1.0003216019200882, 0.9999967634546776, 1.0001272521879776, 0.9998808444043138, 1.000053381642593, 5.736101966562185, 8.302278575896453], 26, 1.703423298426671e-5, BlackBoxOptim.AdaptiveDiffEvoRandBin{3}(BlackBoxOptim.AdaptiveDiffEvoParameters(BlackBoxOptim.BimodalCauchy(Distributions.Cauchy{Float64}(μ=0.65, σ=0.1), Distributions.Cauchy{Float64}(μ=1.0, σ=0.1), 0.5, false, true), BlackBoxOptim.BimodalCauchy(Distributions.Cauchy{Float64}(μ=0.1, σ=0.1), Distributions.Cauchy{Float64}(μ=0.95, σ=0.1), 0.5, false, true), [1.0, 0.5765486522654429, 1.0, 0.913625942341414, 0.5242504320023261, 0.6633747249867848, 0.608058678048411, 0.5673376126836491, 0.9315060474240002, 0.7033586383198744  …  0.7205390915576921, 1.0, 1.0, 0.6935959388635117, 1.0, 0.2859949275768689, 1.0, 0.6237900962821951, 0.48828185423539194, 0.6755089258410896], [0.931788282108987, 1.0, 0.5627505779869137, 0.9107404867348652, 0.21432678745690192, 1.0, 0.9642403477472526, 0.20361939628553827, 0.9817914515012881, 0.06603880596474401  …  0.6991833158712031, 0.10178800015506398, 1.0, 0.06062886642091275, 0.9338435973530369, 0.08004718680336753, 0.035056950633262585, 1.0, 0.37734628632213585, 0.14976610725479508])), 0)], Base.Threads.SpinLock(0))))</code></pre><pre><code class="language-julia hljs">result.archive_output.best_candidate[end-1:end]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Float64}:
 7.312152719349321
 9.348955622995557</code></pre><p>Here as our model had 2 parameters, we look at the last two indexes of <code>result</code> to get our parameter values and the rest of the values are the initial values of the shorter timespans as described in the reference section.</p><p>The objective function for Two Stage method can be created and passed to an optimizer as</p><pre><code class="language- hljs">two_stage_obj = two_stage_objective(ms_prob, t, data)
optprob = Optimization.OptimizationProblem(two_stage_obj, [1.3,0.8,2.8,1.2])
result = solve(optprob, Optim.BFGS())</code></pre><p>The default kernel used in the method is <code>Epanechnikov</code> others that are available are <code>Uniform</code>,  <code>Triangular</code>, <code>Quartic</code>, <code>Triweight</code>, <code>Tricube</code>, <code>Gaussian</code>, <code>Cosine</code>, <code>Logistic</code> and <code>Sigmoid</code>, this can be passed by the <code>kernel</code> keyword argument. <code>loss_func</code> keyword argument can be used to pass the loss function (cost function) you want  to use and passing a valid <a href="https://docs.sciml.ai/Optimization/stable/tutorials/intro/#Controlling-Gradient-Calculations-(Automatic-Differentiation)"><code>adtype</code> argument</a> enables Auto Differentiation.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« DiffEqParamEstim.jl: Parameter Estimation for Differential Equations</a><a class="docs-footer-nextpage" href="../global_optimization/">Global Optimization via NLopt »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Wednesday 21 December 2022 10:38">Wednesday 21 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
